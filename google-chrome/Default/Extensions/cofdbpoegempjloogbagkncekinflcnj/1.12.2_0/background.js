var background=function(e){"use strict";function t(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function n(){return crypto.randomUUID()}function a(){const e=new Uint32Array(28);return crypto.getRandomValues(e),Array.from(e,(e=>("0"+e.toString(16)).slice(-2))).join("")}function r(e){try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}}const o=[{langCode:"DE",langCodeForSpeech:"de-DE",supportsFormality:!0},{langCode:"EN-GB",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"EN-US",langCodeForSpeech:"en",voice:"Google UK English Male"},{langCode:"FR",langCodeForSpeech:"fr-FR",voice:"Thomas",supportsFormality:!0},{langCode:"ES",langCodeForSpeech:"es-ES",voice:"Google espaÃ±ol",label:"ES",supportsFormality:!0},{langCode:"IT",langCodeForSpeech:"it-IT",supportsFormality:!0},{langCode:"ID",langCodeForSpeech:"id-ID"},{langCode:"PL",langCodeForSpeech:"pl-PL",supportsFormality:!0},{langCode:"NL",langCodeForSpeech:"nl-NL",voice:"Google Nederlands",label:"NL",supportsFormality:!0},{langCode:"PT-PT",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"PT-BR",langCodeForSpeech:"pt-PT",supportsFormality:!0},{langCode:"RU",langCodeForSpeech:"ru-RU",supportsFormality:!0},{langCode:"ZH",langCodeForSpeech:"zh-CN"},{langCode:"JA",langCodeForSpeech:"ja-JP",supportsFormality:!0},{langCode:"BG",langCodeForSpeech:"bg-BG"},{langCode:"CS",langCodeForSpeech:"cs-CZ"},{langCode:"DA",langCodeForSpeech:"da-DK"},{langCode:"ET",langCodeForSpeech:"et"},{langCode:"FI",langCodeForSpeech:"fi-FI",voice:"Satu"},{langCode:"EL",langCodeForSpeech:"el-GR"},{langCode:"HU",langCodeForSpeech:"hu-HU"},{langCode:"LV",langCodeForSpeech:"lv"},{langCode:"LT",langCodeForSpeech:"lt"},{langCode:"RO",langCodeForSpeech:"ro-RO"},{langCode:"SK",langCodeForSpeech:"sk-SK"},{langCode:"SL",langCodeForSpeech:"sl"},{langCode:"SV",langCodeForSpeech:"sv-SE"},{langCode:"TR",langCodeForSpeech:"tr-TR"},{langCode:"UK",langCodeForSpeech:"uk-UA"},{langCode:"NB",langCodeForSpeech:"nb-NO"},{langCode:"KO",langCodeForSpeech:"ko-KR"}],s=0,c="inline",i="automatic",l="manual",d="input",g=1,u=2,p=3,h=1500,m=5e3,T=1,f=2,y=3,w=1,E=2,_=1,L=2,I=3,S="HINT_KEYBOARD_SHORTCUT",A="INLINE_TRANSLATION_TRIGGER_ICON",C="INLINE_TRANSLATION_SETTINGS_ICON",b="INLINE_TRANSLATION_SETTING_POPUP",k="INPUT_TRANSLATION_TRIGGER_ICON",R="INPUT_TRANSLATION_SETTINGS_ICON",D="INPUT_TRANSLATION_SETTING_POPUP",N="SETTINGS_PAGE_FPT",O="SETTINGS_PAGE_READING",P="SETTINGS_PAGE_WRITING",x="FPT_HIDE_MODAL",v="INPUT_TRANSLATION_READ_MORE_LINK",U="INLINE_TRANSLATION_READ_MORE_LINK",F="FPT_TRANSLATION_READ_MORE_LINK",M="EXTENSION_HUB_TOGGLE_SWITCH",G="HUB_CUSTOMIZE_SHORTCUT",W="HUB_LOGIN_BUTTON",V="HUB_UPGRADE_TO_PRO_LINK",H="HUB_TRY_PRO_LINK",j="SETTINGS_PAGE_CUSTOMIZE_SHORTCUT_BUTTON",B="HUB_FPT_ENABLE_CHECKBOX",q="HUB_FPT_DISABLE_CHECKBOX",K="DEEPL_WRITE_ICON",$="gmailOnboardingPopup",X="gmailOnboardingIcon",Y="gmailCharLimitLogin",J="gmailFeedbackSurvey",Z="HUB_VIEW_INTEGRATIONS",z="HUB_CLOSE_CUSTOMIZATIONS_WIDGET",Q="GSLIDES_FEEDBACK_SURVEY",ee="GSLIDES_CHAR_LIMIT_LOGIN",te="ZENDESK_TRY_PRO_LINK",ne="trigger-translation",ae="change-language",re="CLICK_ON_SHORTCUT_NOTIFICATION",oe="CLICK_ON_INLINE_TRANSLATION_SHOW_ALTERNATIVES",se="CLICK_ON_INLINE_TRANSLATION_CLOSE_ICON",ce="CLICK_ON_LOGOUT_MENU_ENTRY",ie="DISABLE_PER_SITE",le="DISABLE_EVERYWHERE",de="ENABLE_EVERYWHERE",ge="ENABLE_PER_SITE",ue="INPUT_TRANSLATION",pe="INLINE_TRANSLATION",he="FULL_PAGE_TRANSLATION",me=1,Te=2,fe=3,ye=4,we="OPEN_PAGE",Ee="BACK_BUTTON",_e="NEXT_BUTTON",Le="NAVIGATION",Ie=0,Se=1,Ae=2,Ce=3,be="cofdbpoegempjloogbagkncekinflcnj",ke="fancfknaplihpclbhbpclnmmjcjanbaf",Re="ocpdpnakdghopjcifldjidbdmfobmmoi",De={deepl:1,linguee:2,google_translate:3,word_365:4,power_point_365:5,jira:6,confluence:7,gmail:8},Ne="DEFAULT",Oe="GDOCS",Pe="ZENDESK",xe="WHATSAPP_WEB",ve="TWITTER",Ue="GMAIL",Fe="GSLIDES",Me="translate",Ge="write",We="USER",Ve="EXTENSION",He="OPEN_TICKET",je="DETECT_TICKET_LANGUAGE",Be="SWITCH_TICKET_LANGUAGE",qe="ENABLE_AUTOTRANSLATE",Ke="DISABLE_AUTOTRANSLATE",$e="TRANSLATE_MESSAGE",Xe="TRANSLATE_INPUT",Ye="ERROR",Je="TRANSLATION",Ze="LOGIN",ze="CHAT",Qe="MESSAGE",et="free",tt="pro",nt="none",at="TEXT_REFINEMENT_REQUEST",rt="GDOCS_INSERT_COPY",ot="GDOCS_DISCARD_COPY",st="GDOCS_CHAR_LIMIT_REACHED",ct="RESULT_ACCEPTED",it="RESULT_REVERTED",lt="ERROR",dt="RESULT_ACCEPTED",gt="RESULT_REVERTED",ut="ALTERNATIVES_OPENED",pt="SEGMENTATION_SELECTED",ht="ALTERNATIVE_SELECTED",mt="READING_VIEW_TRANSLATE",Tt="COMPOSE_VIEW_TRANSLATE",ft="COMPOSE_VIEW_IMPROVE",yt="ANONYMOUS_USER_LIMIT_EXCEEDED",wt="FREE_ACCOUNT_LIMIT_EXCEEDED",Et="PRO_TRIAL",_t="LOGIN",Lt="SIGNUP",It="word",St="sentence",At="None",Ct="Pro",bt="Free",kt={share_feedback_survey:"DOCS_GOOGLE_COM_FEEDBACK_FORM",new_share_feedback_survey:"NEW_FEEDBACK_FORM",try_DeepL_Pro:"DEEPL_COM_PRO",show_more_translation:"DEEPL_COM_TRANSLATOR",deepl_translator_home:"DEEPL_COM_HOMEPAGE",deepl_write_home:"DEEPL_COM_WRITE",deepl_translator_docs:"DEEPL_COM_DOCTRANS",shortcut_settings:"SHORTCUT_SETTINGS",support_article:"SUPPORT_ARTICLE",chrome_write_a_review:"CHROME_WRITE_A_REVIEW",edge_write_a_review:"EDGE_WRITE_A_REVIEW",gmail_feedback_survey:"GMAIL_FEEDBACK_SURVEY",gslides_feedback_survey:"GSLIDES_FEEDBACK_SURVEY",external:{whatsapp:"EXTERNAL_WHATSAPP",twitter:"EXTERNAL_TWITTER",youtube:"EXTERNAL_YOUTUBE",facebook:"EXTERNAL_FACEBOOK",github:"EXTERNAL_GITHUB",discord:"EXTERNAL_DISCORD",telegram:"EXTERNAL_TELEGRAM",reddit:"EXTERNAL_REDDIT",gmail:"EXTERNAL_GMAIL",gdocs:"EXTERNAL_GDOCS"},deepl_support:"DEEPL_SUPPORT"},Rt={DOCS_GOOGLE_COM_FEEDBACK_FORM:"https://deepl.typeform.com/to/MkMfP2Y6",NEW_FEEDBACK_FORM:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",DEEPL_COM_PRO:"https://www.deepl.com/pro",DEEPL_COM_TRANSLATOR:"https://www.deepl.com/translator",DEEPL_COM_WRITE:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.12.2",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.12.2",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"}.deeplWrite,DEEPL_COM_DOCTRANS:"https://www.deepl.com/translator/files",SHORTCUT_SETTINGS:"chrome://extensions/shortcuts",SUPPORT_ARTICLE:"https://support.deepl.com/hc/articles/4407580229522",CHROME_WEBSTORE:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",EDGE_WEBSTORE:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",GMAIL_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW",GSLIDES_FEEDBACK_SURVEY:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",EXTERNAL:{WHATSAPP:"https://web.whatsapp.com",TWITTER:"https://www.twitter.com",YOUTUBE:"https://www.youtube.com",FACEBOOK:"https://www.facebook.com",GITHUB:"https://www.github.com",DISCORD:"https://www.discord.com",TELEGRAM:"https://web.telegram.org",REDDIT:"https://www.reddit.com",GMAIL:"https://www.gmail.com",GDOCS:"https://docs.google.com"},DEEPL_SUPPORT:"https://support.deepl.com/hc"};function Dt(e){const{destination:t,...n}=e;if(void 0!==t)switch(t){case kt.share_feedback_survey:return Rt.DOCS_GOOGLE_COM_FEEDBACK_FORM;case kt.new_share_feedback_survey:return Rt.NEW_FEEDBACK_FORM;case kt.try_DeepL_Pro:return n?.utmContent?Pt(Rt.DEEPL_COM_PRO,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):Rt.DEEPL_COM_PRO;case kt.show_more_translation:return n?function({sourceLang:e,targetLang:t,textToShare:n}){if(!e||!t||!n)return"";const a=new URL(Rt.DEEPL_COM_TRANSLATOR);let r=`${e.toLowerCase()}/${t.toLowerCase()}/${encodeURIComponent(n)}`;return a.hash=r,a.href}(n):void console.error("Invalid action.");case kt.deepl_translator_home:return n?.utmContent?Pt(Rt.DEEPL_COM_TRANSLATOR,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):Rt.DEEPL_COM_TRANSLATOR;case kt.deepl_write_home:return n?.utmContent?Pt(Rt.DEEPL_COM_WRITE,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):Rt.DEEPL_COM_WRITE;case kt.deepl_translator_docs:return n?.utmContent?Pt(Rt.DEEPL_COM_DOCTRANS,[["utm_source","browser_extension"],["utm_medium","chrome"],["utm_content",n?.utmContent]]):Rt.DEEPL_COM_DOCTRANS;case kt.shortcut_settings:return Rt.SHORTCUT_SETTINGS;case kt.support_article:return Rt.SUPPORT_ARTICLE;case kt.external.whatsapp:return Rt.EXTERNAL.WHATSAPP;case kt.external.twitter:return Rt.EXTERNAL.TWITTER;case kt.external.youtube:return Rt.EXTERNAL.YOUTUBE;case kt.external.facebook:return Rt.EXTERNAL.FACEBOOK;case kt.external.github:return Rt.EXTERNAL.GITHUB;case kt.external.discord:return Rt.EXTERNAL.DISCORD;case kt.external.telegram:return Rt.EXTERNAL.TELEGRAM;case kt.external.reddit:return Rt.EXTERNAL.REDDIT;case kt.external.gmail:return Rt.EXTERNAL.GMAIL;case kt.external.gdocs:return Rt.EXTERNAL.GDOCS;case kt.deepl_support:return Rt.DEEPL_SUPPORT;case kt.chrome_write_a_review:return Rt.CHROME_WEBSTORE;case kt.edge_write_a_review:return Rt.EDGE_WEBSTORE;case kt.gmail_feedback_survey:return Rt.GMAIL_FEEDBACK_SURVEY;case kt.gslides_feedback_survey:return Rt.GSLIDES_FEEDBACK_SURVEY;default:return}}function Nt(e){const t=Dt(e);console.log("redirectURL",t),t&&chrome.tabs.create({url:Ot(t),active:!0})}function Ot(e){return new URL(e).href}function Pt(e,t){if(0===t.length||!e)return;const n=new URL(e);return t.forEach((e=>{2===e.length&&n.searchParams.append(e[0],e[1])})),n.href}const xt=()=>{let e=navigator.languages?navigator.languages[0].substr(0,2).toUpperCase():"EN";var t;e="EN"===(t=e)?"EN-GB":"PT"===t?"PT-PT":t;return o.map((e=>e.langCode)).includes(e)?e:"EN"},vt=()=>{const e={};return o.forEach((t=>{let n=t.langCode;["EN-GB","EN-US"].includes(n)&&(n="EN"),["PT-PT","PT-BR"].includes(n)&&(n="PT"),e[n]=0})),e};const Ut="production",Ft="development",Mt="testing";function Gt(){return Ut}function Wt(){return Gt()===Ft}function Vt(e){chrome.runtime.sendMessage({action:"dlTrackError",errorMessage:e})}const Ht="PROTOCOL_ERROR",jt="FULL_PAGE_SERVER_ERROR",Bt="-32003",qt="403",Kt="ENTRY_NOT_FOUND",$t="SERVER_ERROR",Xt="INSTALLATION_ERROR",Yt="TRANSLATED_INPUT_NOT_SET",Jt="FREE_ACCOUNT_LIMIT_EXCEEDED",Zt="ANONYMOUS_LIMIT_EXCEEDED";class zt extends Error{constructor(e){super(e),this.name=Ht,this.message=e}}class Qt extends Error{constructor(e){super(e),this.name=jt,this.message=e}}class en extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class tn extends Error{constructor(e,t){super(t),this.name=Jt,this.limit=e,this.message=t}}class nn extends Error{constructor(e,t){super(t),this.name=Zt,this.limit=e,this.message=t}}class an extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}function rn(e){try{Vt(`${e.name} ${e.message}`),console.error(e.name,e.message)}catch(e){console.error(e)}return{error:e.name}}function on(){return{url:"https://s.deepl.com/chrome/statistics"}}function sn(e){switch(e){case l:return 1;case i:return 2;case c:return 3;case d:return 4;default:return 0}}function cn(e){switch(e){case Kt:return 1;case $t:return 2}}function ln(e){switch(e){case T:return w;case f:return E;default:return 0}}function dn(e){switch(e){case T:return _;case f:return L;case y:return I;default:return 0}}function gn(e){return e===S?1:0}function un(e){switch(e){case k:return 1;case A:return 2;case b:return 3;case D:return 4;case N:return 5;case O:return 6;case P:return 7;case x:return 8;case R:return 9;case C:return 10;case v:return 11;case U:return 12;case F:return 13;case M:return 14;case G:return 15;case W:return 16;case V:return 17;case H:return 18;case j:return 19;case B:return 20;case q:return 21;case K:return 22;case Z:return 23;case z:return 24;case $:return 25;case X:return 26;case Y:return 27;case J:return 28;case Q:return 29;case ee:return 30;case te:return 31;default:return 0}}function pn(e){return e===ne?1:0}function hn(e){switch(e){case re:return 60011;case oe:return 60026;case se:return 60027;case ce:return 60028;default:return 0}}function mn(e){switch(e){case ue:return 1;case pe:return 2;case he:return 3;default:return 0}}function Tn(e){switch(e){case le:return 1;case ie:return 2;case de:return 3;case ge:return 4;default:return 0}}function fn(e){switch(e){case"top":return me;case"right":return Te;case"bottom":return fe;case"left":return ye;default:return 0}}function yn(e){switch(e){case kt.shortcut_settings:return Rt.SHORTCUT_SETTINGS;case kt.support_article:return Rt.SUPPORT_ARTICLE;case kt.external.whatsapp:return Rt.EXTERNAL.WHATSAPP;case kt.external.twitter:return Rt.EXTERNAL.TWITTER;case kt.external.youtube:return Rt.EXTERNAL.YOUTUBE;case kt.external.facebook:return Rt.EXTERNAL.FACEBOOK;case kt.external.github:return Rt.EXTERNAL.GITHUB;case kt.external.discord:return Rt.EXTERNAL.DISCORD;case kt.external.telegram:return Rt.EXTERNAL.TELEGRAM;case kt.external.reddit:return Rt.EXTERNAL.REDDIT;default:return""}}function wn(e){switch(e){case we:return 1;case Ee:return 2;case _e:return 3;case Le:return 4;default:return 0}}function En(e){switch(e){case be:return Se;case ke:return Ae;case Re:return Ce;default:return Ie}}function _n(e){return De[e]||0}function Ln(e){switch(e){case Ne:return 1;case Oe:return 2;case xe:return 3;case ve:return 4;case Pe:return 5;case Ue:return 6;case Fe:return 7;default:return 0}}function In(e){switch(e){case 60026:case 60027:return!0;default:return!1}}function Sn(e){switch(e){case We:return 1;case Ve:return 2;default:return 0}}function An(e){switch(e){case Je:return 1;case Ze:return 2;default:return 0}}function Cn(e){switch(e){case Qe:return 1;case ze:return 2;default:return 0}}function bn(e){switch(e){case et:return 1;case tt:return 2;case nt:return 3;default:return 0}}function kn(e){switch(e){case mt:return 1;case Tt:return 2;case ft:return 3;default:return 0}}function Rn(e){switch(e){case yt:return 1;case wt:return 2;default:return 0}}function Dn(e){switch(e){case Me:return 1;case Ge:return 2;default:return 0}}function Nn(e){switch(e){case _t:return 1;case Lt:return 2;case Et:return 3;default:return 0}}function On(e){switch(e){case It:return 1;case St:return 2;default:return 0}}function Pn(e){switch(e){case At:return 1;case Ct:return 2;case bt:return 3;default:return 0}}const xn="Chrome",vn="Edge",Un="Brave",Fn="Firefox",Mn="Opera",Gn="Safari";function Wn(e,t){let n;try{switch(e){case xn:case Un:n=t.split("Chrome/")[1].split(" ")[0];break;case vn:n=t.split("Edg/")[1].split(" ")[0];break;case Fn:n=t.split("Firefox/")[1].split(" ")[0];break;case Mn:n=t.split("OPR/")[1].split(" ")[0];break;case Gn:n=t.split("Version/")[1].split(" ")[0]}}catch(t){console.error(`Could not get the browsers (${e}) version from user agent`,t)}try{!n&&navigator?.userAgentData&&function(e){return e===xn||e===vn||e===Un||e===Mn}(e)&&(n=Vn(e).version)}catch(t){console.error(`Could not get the chromium browsers (${e}) version`,t)}return n&&"string"==typeof n?n:"unknown_browser_version"}function Vn(e){if(!navigator.userAgentData||!e)return;const t=new RegExp(`${e}`,"i");return navigator.userAgentData.brands.filter((e=>t.test(e.brand)))[0]}async function Hn(e){let t,n,a,r,o,s,c,i,l=!1;try{const e=await sr(["session","installationId"]);n=e.session.id,t=e.installationId}catch(e){console.error(`DAP: Failed to fetch settings. Error: ${e.message}`)}try{const e=await Er();l=!!e.accountId,a=bn(e.translatorServiceType),r=bn(e.apiServiceType),o=bn(e.docTranslatorServiceType),c=l?2===a||2===r||2===o?u:p:g,i=e.sessionType?Pn(e.sessionType):Pn(At)}catch(e){console.error(`DAP: Failed to fetch user information. Error: ${e.message}`)}try{s=await Lr()}catch(e){console.error(e)}const d=function(){const e=navigator?.userAgent||"unknown_user_agent",t=navigator?.userAgentData?.platform||navigator?.platform||"unknown_platform";let n="unknown_browser",a="unknown_browser_version";const r=navigator?.language||"unknown_browser_language";try{const t=e.match(/chrome|chromium|crios/i),r=e.match(/edg/i)||Vn(vn),o=e.match(/firefox|fxios/i),s=e.match(/opr\//i)||Vn(Mn),c=e.match(/safari/i),i=Vn(Un);t?(n=xn,r&&(n=vn),s&&(n=Mn),i&&(n=Un)):r?n=vn:o?n=Fn:s?n=Mn:c&&(n=Gn),a=Wn(n,e)}catch(e){console.error("Could not get the name of the brower",e)}return{userAgent:e,platform:t,browser:n,browserVersion:a,browserLang:r}}(),h=await Sr(),m={eventId:void 0,extensionVersion:"1.12.2",sessionId:n,sessionType:i,installationId:t,browserInstanceId:s,originStore:En(chrome.runtime.id),userInfos:{userType:c,translatorServiceType:a,apiServiceType:r,docTranslatorServiceType:o},userAgent:d.userAgent,platform:d.platform,browser:d.browser,browserVersion:d.browserVersion,browserLang:d.browserLang,clientExperiments:h},T=e?e(m):m;return fetch("https://s.deepl.com/chrome/statistics",{method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},body:JSON.stringify(T)}).then((e=>{e.ok||console.log(`DAP ${T.eventId} request failed: ${e}`)}))}async function jn(e){return Hn((t=>({...t,eventId:60001,translationRequestData:{extensionVersion:"1.12.2",domainName:e.domainName,userId:e.installationId,translationTrigger:sn(e.trigger),translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},...e.translationPerformance&&{translationPerformance:e.translationPerformance},nicheIntegration:Ln(e.nicheIntegration||Ne)}})))}async function Bn(e){return Hn((t=>({...t,eventId:60002,errorData:{extensionVersion:"1.12.2",errorCode:e.errorCode,errorMessage:e.errorMessage}})))}async function qn(e){return Hn((t=>({...t,eventId:60003,translationErrorData:{errorData:{extensionVersion:"1.12.2",errorCode:e.errorCode,errorMessage:e.errorMessage},targetLang:e.targetLang,domainName:e.domainName,websiteLanguage:e.websiteLanguage,sourceLength:e.characterCount,translationTrigger:sn(e.trigger)}})))}async function Kn(e){return Hn((t=>({...t,eventId:60004,contentScriptErrorData:{errorData:{extensionVersion:"1.12.2",errorCode:e.errorCode,errorMessage:e.errorMessage},domainName:e.domainName}})))}async function $n(e){return Hn((t=>({...t,eventId:60005,inputInjectionData:{extensionVersion:"1.12.2",domainName:e.domainName}})))}async function Xn(e){return Hn((t=>({...t,eventId:60007,extensionOpenedData:{extensionVersion:"1.12.2",domainName:e.domainName,extensionOpenedFrom:e.extensionOpenedFrom}})))}async function Yn(e){return Hn((t=>({...t,eventId:60008,logoClickedData:{extensionVersion:"1.12.2",logoClickedFrom:e.logoClickedFrom}})))}async function Jn(e){return Hn((t=>({...t,eventId:60009,notificationViewedData:{extensionVersion:"1.12.2",notificationType:gn(e.notificationType)}})))}async function Zn(e){return Hn((t=>({...t,eventId:60010,shortcutUsedData:{shortcutType:pn(e.shortcutType),uiLocation:un(e.location),shortcut:e.shortcut,nicheIntegration:Ln(e.nicheIntegration||Ne)}})))}async function zn(e){const t={eventId:hn(e.uiAction)};return In(t.eventId)&&(t.payload={nicheIntegration:Ln(e.nicheIntegration||Ne)}),Hn((e=>({...e,...t})))}async function Qn(){return Hn((e=>({...e,eventId:60012})))}async function ea(){return Hn((e=>({...e,eventId:60013})))}async function ta(e){return Hn((t=>({...t,eventId:60014,inlineSettingOpenedData:{uiFunction:mn(e.uiFunction),uiLocation:un(e.uiLocation),nicheIntegration:Ln(e.nicheIntegration)}})))}async function na(e){return Hn((t=>({...t,eventId:60015,settingChangedData:{settingType:Tn(e.settingType),uiFunction:mn(e.uiFunction),uiLocation:un(e.uiLocation),domainName:e.domainName}})))}async function aa(e){return Hn((t=>({...t,eventId:60016,detectLanguageData:{domainName:e.domainName,language:e.language}})))}async function ra(e){return Hn((t=>({...t,eventId:60017,rightClickData:{domainName:e.domainName,translationType:e.translationType}})))}async function oa(e){return Hn((t=>({...t,eventId:60018,inlinePositionChangeData:{newPosition:fn(e.newPosition)}})))}async function sa(e){return Hn((t=>({...t,eventId:60019,inlineDragStartData:{nicheIntegration:Ln(e?.nicheIntegration||Ne)}})))}async function ca(e){return Hn((t=>({...t,eventId:60020,whatsAppMessageTranslatedData:{messageLang:e.messageLang,targetLang:e.targetLang,messageLength:e.messageLength,translator:Cn(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}})))}async function ia(e){return Hn((t=>({...t,eventId:60021,whatsAppMessageTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang,translator:Cn(e.translator),numberOfLanguages:e.numberOfLanguages,numberOfMessages:e.numberOfMessages}}})))}async function la(e){return Hn((t=>({...t,eventId:60057,twitterTweetTranslationFailedData:{errorCode:e.errorCode,domainName:e.domainName,translationConfig:{messageLength:e.messageLength,targetLang:e.targetLang,messageLang:e.messageLang}}})))}async function da(e){return Hn((t=>({...t,eventId:60022,fptHideData:{hideOption:e.hideOption,sourceLang:e.sourceLang,domainName:e.domainName,uiLocation:un(e.uiLocation)}})))}async function ga(e){return Hn((t=>({...t,eventId:60023,inlineCopyData:{targetLang:e.targetLang,targetLength:e.targetLength,nicheIntegration:Ln(e.nicheIntegration||Ne)}})))}async function ua(e){return Hn((t=>({...t,eventId:60024,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,actionType:e.actionType,nicheIntegration:Ln(e.nicheIntegration||Ne)}})))}async function pa(e){return Hn((t=>({...t,eventId:60025,iconHoverData:{uiLocation:un(e.uiLocation),domainName:e.domainName,nicheIntegration:Ln(e.nicheIntegration||Ne)}})))}async function ha(e){return Hn((t=>({...t,eventId:60029,onboardingStepChangeData:{previousStep:e.previousStep,newStep:e.newStep,trigger:wn(e.trigger),secondsOnOnboarding:e.secondsOnOnboarding,secondsOnPreviousStep:e.secondsOnPreviousStep}})))}async function ma(e){return Hn((t=>({...t,eventId:60030,onboardingOpenExternalPageData:{url:yn(e.url)}})))}async function Ta(e){return Hn((t=>({...t,eventId:60031,readMoreClickedData:{uiLocation:un(e.uiLocation)}})))}async function fa(e){return Hn((t=>({...t,eventId:60032,landOnWebsiteData:{website:_n(e.website)}})))}async function ya(e){return Hn((t=>({...t,eventId:60033,inlineListenData:{targetLang:e.targetLang,targetLength:e.targetLength,triggerType:e.triggerType,nicheIntegration:Ln(e.nicheIntegration||Ne)}})))}async function wa(e){return Hn((t=>({...t,eventId:60034,openInputHighlighterData:{domainName:e.domainName}})))}async function Ea(e){return Hn((t=>({...t,eventId:60035,closeInputHighlighterData:{trigger:e.trigger}})))}async function _a(e){return Hn((t=>({...t,eventId:60036,gdocsReplaceTextData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength,targetLength:e.targetLength}})))}async function La(){return Hn((e=>({...e,eventId:60037})))}async function Ia(e){return Hn((t=>({...t,eventId:60038,openInputHighlighterData:{domainName:e.domainName}})))}async function Sa(e){return Hn((t=>({...t,eventId:60039,closeInputHighlighterData:{trigger:e.trigger}})))}async function Aa(e){return Hn((t=>({...t,eventId:60040,dictionaryStatus:{status:e.status,langPair:e.langPair}})))}async function Ca(){return Hn((e=>({...e,eventId:60041})))}async function ba(){return Hn((e=>({...e,eventId:60042})))}async function ka(e){return Hn((t=>({...t,eventId:60043,errorData:{lingueeError:cn(e.error)}})))}async function Ra(e,t){let n;switch(e){case He:n=60044;break;case je:n=60045;break;case Be:n=60046;break;case qe:n=60047;break;case Ke:n=60048;break;case $e:n=60049;break;case Xe:n=60050;break;case Ye:n=60051;break;default:return}return Hn((e=>({...e,eventId:n,zendeskMetaData:{agentLanguage:t.agentLanguage,ticketLanguage:t.ticketLanguage,isTicketLanguageAutodetected:t.isTicketLanguageAutodetected,isTicketLanguageSupported:t.isTicketLanguageSupported,isAutoTranslateEnabled:t.isAutoTranslateEnabled,sourceTextLength:t.sourceTextLength,targetTextLength:t.targetTextLength,inputHasSelection:t.inputHasSelection,error:t.error}})))}async function Da(){return Hn((e=>({...e,eventId:60054})))}async function Na(e){const t=Math.round(await yr()/60);return Hn((n=>({...n,eventId:60055,logoutData:{trigger:Sn(e.trigger),minutesSinceLastLogin:t,reason:e.reason}})))}async function Oa(e){return Hn((t=>({...t,eventId:60052,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function Pa(e){return Hn((t=>({...t,eventId:60053,gdocsMaxCharExceededData:{sourceLang:e.sourceLang,targetLang:e.targetLang,sourceLength:e.sourceLength}})))}async function xa(e){return Hn((t=>({...t,eventId:60056,sessionTypeData:{sessionType:e.sessionType,trigger:An(e.trigger)}})))}async function va(e){let t="";try{t=await hr()}catch(e){console.log(`DAP: Failed to fetch session type. Error: ${e.message}`)}return Hn((n=>({...n,eventId:60058,onboardingModalShownData:{nicheIntegration:Ln(e.nicheIntegration||Ne),sessionType:t}})))}async function Ua(e){return Hn((t=>({...t,eventId:60059,UILocationClickedData:{target:un(e)}})))}async function Fa(){return Hn((e=>({...e,eventId:60060})))}async function Ma(){return Hn((e=>({...e,eventId:60061})))}async function Ga(e,t){let n;switch(e){case at:n=60062;break;case rt:n=60063;break;case ot:n=60064;break;case st:n=60065;break;case lt:n=60066;break;case ct:n=60071;break;case it:n=60072;break;default:return}return Hn((e=>({...e,eventId:n,deeplWriteMetaData:{lang:t.lang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:Ln(t.nicheIntegration||Ne),error:t.error}})))}async function Wa(){if(!await ur())return;const e=await Ir();return Hn((t=>({...t,eventId:60067,accountData:{accountUuid:e}})))}async function Va(){const e=await Ir();return Hn((t=>({...t,eventId:60068,accountData:{accountUuid:e}})))}async function Ha(){const e=await Ir();return Hn((t=>({...t,eventId:60069,accountData:{accountUuid:e}})))}async function ja(e,t){let n;switch(e){case dt:n=60073;break;case gt:n=60074;break;default:return}return Hn((e=>({...e,eventId:n,translationResultActionData:{sourceLang:t.sourceLang,sourceLength:t.sourceLength,targetLength:t.targetLength,nicheIntegration:Ln(t.nicheIntegration||Ne),error:t.error}})))}async function Ba(e){return Hn((t=>({...t,eventId:60070,customizationOnOffData:{nicheIntegration:Ln(e.nicheIntegration||Ne),uiLocation:un(e.location),customizationEnabled:e.customizationEnabled}})))}async function qa(e){return Hn((t=>({...t,eventId:60075,gmailCharLimitReachedData:{gmailActionType:kn(e.type)}})))}async function Ka(e){return Hn((t=>({...t,eventId:60076,upgradeNotificationDisplayedData:{type:Rn(e)}})))}async function $a(e){return Hn((t=>({...t,eventId:60077,upgradeNotificationClosedData:{type:Rn(e)}})))}async function Xa(e,t){return Hn((n=>({...n,eventId:60078,upgradeNotificationActionData:{type:Rn(e),action:Nn(t)}})))}async function Ya(e,t){let n;switch(e){case ut:n=60079;break;case pt:n=60080;break;case ht:n=80081;break;default:return}return Hn((e=>({...e,eventId:n,alternativesMetaData:{sourceLang:t.sourceLang,targetLang:t.targetLang,nicheIntegration:Ln(t.nicheIntegration||Ne),contentProcessingMode:Dn(t.contentProcessingMode),...t.alternativesSegmentation&&{alternativesSegmentation:On(t.alternativesSegmentation)}}})))}let Ja;const Za="dlCache";function za(){return new Promise(((e,t)=>{let n=indexedDB.open("dlBrowserExtension",1);n.onerror=function(){t("Error creating database.")},n.onsuccess=function(t){Ja=t.target.result,e()},n.onupgradeneeded=function(t){Ja=t.target.result,Ja.objectStoreNames.contains(Za)||Ja.createObjectStore(Za,{keyPath:"id"}),e()}}))}async function Qa(e,t,n){return Ja||await za(),new Promise(((a,r)=>{let o=Ja.transaction(n,"readwrite").objectStore(n).put({id:e,data:t,meta:{createdAt:Date.now()}});o.onsuccess=function(){a()},o.onerror=function(e){r(e)}}))}async function er(e,t){return Ja||await za(),new Promise(((n,a)=>{let r=Ja.transaction(t,"readonly").objectStore(t).get(e);r.onerror=function(e){a(e)},r.onsuccess=function(){r.result?n(r.result):n(null)}}))}function tr(e){return Qa("dlclientstate",e,Za)}async function nr(){const e=await er("dlclientstate",Za);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>20?void 0:e.data}function ar(e){return Qa("dlexperiments",e,Za)}async function rr(){try{const e=await er("dlexperiments",Za);return e&&e.meta&&e.data?e.data:[]}catch(e){return[]}}async function or(){const e=await er("dlexperiments",Za);if(!e||!e.meta)return;return(Date.now()-e.meta.createdAt)/6e4>9||!e.data||0===e.data.length?void 0:e.data}async function sr(e){if(e.includes("session")){const e=await chrome.storage.sync.get(["session"]);e&&!e.session&&await cr()}return new Promise(((t,n)=>{chrome.storage.sync.get(e,(a=>{a?t(a):n(`Can not get ${e}`)}))}))}async function cr(){const e=n();await chrome.storage.sync.set({session:{id:e,timestamp:Date.now()}});try{await Wa()}catch(e){console.error(e)}}async function ir(){const{session:e}=await sr(["session"]);!e||(Date.now()-e.timestamp)/6e4>30?await cr():await chrome.storage.sync.set({session:{...e,timestamp:Date.now()}})}async function lr(e,t,n){const a=r(e);return await chrome.storage.local.set({a_t:e,r_t:t,i_t:n,isLoggedIn:!(!e||!t),isProUser:!(!a||"Pro"!==a.sessionType),sessionType:a?.sessionType}),a?.sessionType}async function dr(){await chrome.storage.local.remove(["a_t","r_t","i_t"]),await chrome.storage.local.set({isLoggedIn:!1,isProUser:!1,sessionType:""})}async function gr(){const e=await chrome.storage.local.get(["a_t","r_t","i_t"]);return{access_token:e?e.a_t:void 0,refresh_token:e?e.r_t:void 0,id_token:e?e.i_t:void 0}}async function ur(){const e=await chrome.storage.local.get(["isLoggedIn"]);return!(!e||!e.isLoggedIn)}async function pr(){const e=await chrome.storage.local.get(["isProUser"]);return!(!e||!e.isProUser)}async function hr(){return(await chrome.storage.local.get(["sessionType"]))?.sessionType}async function mr(){return(await chrome.storage.sync.get(["installationId"])).installationId}async function Tr(){await chrome.storage.local.set({last_login:Date.now()})}async function fr(){await chrome.storage.local.remove(["last_login"])}async function yr(){const e=await chrome.storage.local.get(["last_login"]);return e&&e.last_login?(Date.now()-e.last_login)/1e3:0}async function wr(e){const t=e.featureSet.translator.service,n=e.featureSet.api.service,a=e.featureSet.documentTranslation.service;let r,o;e.loginState?.accountId&&(r=e.loginState.accountId),e.featureSet?.integrations?.browserExtension&&(o=e.featureSet?.integrations?.browserExtension),await chrome.storage.local.set({translatorServiceType:t,apiServiceType:n,docTranslatorServiceType:a,accountId:r||"",featureSet:o})}async function Er(){return await chrome.storage.local.get(["isLoggedIn","isProUser","sessionType","translatorServiceType","apiServiceType","docTranslatorServiceType","accountId"])}async function _r(){await chrome.storage.local.set({browserInstanceId:n()})}async function Lr(){return(await chrome.storage.local.get(["browserInstanceId"])).browserInstanceId}async function Ir(){const e=await chrome.storage.local.get(["accountId","a_t","i_t"]);if(e&&e.accountId)return e.accountId;if(e&&e.a_t){const t=r(e.a_t),n=r(e.i_t);return t.sub||n.sub}}async function Sr(){let e=[];try{e=await rr()}catch(e){}if(!e||0===e.length)return[];return e.map((e=>({id:e.id,variant:e.variant,breakout:e.breakout})))}async function Ar(e="translatorServiceType"){const t=await Er(),n=!!t.accountId,a=t[e];return n?a===tt?u:p:g}async function Cr(e="translatorServiceType"){switch(await Ar(e)){case p:return m;case u:return;default:return h}}async function br(e=!1){if(!e){let e;try{e=await or()}catch(e){}if(e)return e}const t=await mr();let n=[];try{n=await rr()}catch(e){}const a=`https://s.deepl.com/chrome/experiments/${t}`;let r;try{const e=await fetch(a,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:JSON.stringify(n)});if(r=(await e.json()).client_experiments,!r)return n;try{ar(r)}catch(e){}return r}catch(e){return n}}const kr="ACCESS_DENIED",Rr="INVALID_REQUEST",Dr="INVALID_GRANT",Nr="GET_TOKEN_ERROR",Or="INVALID_NONCE";class Pr extends Error{constructor(e,t){super(e),this.name=kr,this.message=e,this.httpStatusCode=t}}class xr extends Error{constructor(e,t){super(e),this.name=Rr,this.message=e,this.httpStatusCode=t}}class vr extends Error{constructor(e,t){super(e),this.name=Dr,this.message=e,this.httpStatusCode=t}}class Ur extends Error{constructor(e,t){super(e),this.name=Nr,this.message=e,this.httpStatusCode=t}}class Fr extends Error{constructor(e){super(e),this.name=Or,this.message=e}}function Mr(e,t){const n=e.split("?")[1];if(n){var a=n.split("&");for(let e=0;e<a.length;e++){const n=a[e].split("=");if(decodeURIComponent(n[0])===t)return decodeURIComponent(n[1])}}}async function Gr(e,t,n="https://test.deepl.com/oidc-login"){const r=a(),o=a(),s=await async function(e){const t=await crypto.subtle.digest("SHA-256",(new TextEncoder).encode(e));return btoa(String.fromCharCode(...new Uint8Array(t))).replace(/=/g,"").replace(/\+/g,"-").replace(/\//g,"_")}(o);return{url:n+"?"+new URLSearchParams([["client_id",e],["redirect_uri",t],["code_challenge",s],["code_challenge_method","S256"],["nonce",r]]),nonce:r,codeVerifier:o}}function Wr(e,t){if(200!==e){if("invalid_request"===t.error)throw new xr(`dl-oidc (get tokens): invalid request - http status: ${e}`,e);if("invalid_grant"===t.error)throw new vr(`dl-oidc (get tokens): invalid grant - http status: ${e}`,e);throw new Ur(`dl-oidc (get tokens): http status: ${e}`,e)}}async function Vr(e,t="https://deepl.com/oidc/token"){const n=await fetch(t,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({grant_type:"refresh_token",refresh_token:e})}),a=await n.json();return Wr(n.status,a),a.access_token}async function Hr(e,t,n=!1){let a=t.access_token;async function r(){return await fetch(e,{...t,headers:{...t.headers,Authorization:a?`Bearer ${a}`:"None"}})}n&&a&&(a=await Vr(t.refresh_token,t.token_url));let o=await r();return 401!==o.status&&403!==o.status||(a=await Vr(t.refresh_token,t.token_url),o=await r()),{response:o,accessToken:a}}function jr(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}async function Br(e=!1,n=!0){if(!e){const e=await nr();if(e)return e}const a=jr("getClientState",{v:"20180814"},t()),o=await gr(),s=n||function(e){try{const t=r(e);if(t.exp&&Date.now()/1e3<t.exp-5)return!1}catch(e){console.error("Error decoding token:",e)}return!0}(o.access_token),{response:c,accessToken:i}=await Hr("https://w.deepl.com/web",{method:"POST",headers:{"Content-Type":"application/json; charset=utf-8"},body:JSON.stringify(a),access_token:o.access_token,refresh_token:o.refresh_token,token_url:"https://w.deepl.com/oidc/token"},s);await lr(i,o.refresh_token,o.id_token);const l=(await c.json()).result;return l&&(tr(l),wr(l)),l}async function qr(e=!1){const t=async()=>{const t=await Gr("chromeExtension",chrome.identity.getRedirectURL(),"https://www.deepl.com/auth/login");return new Promise(((n,a)=>{chrome.identity.launchWebAuthFlow({interactive:!0,url:e?`${t.url}#error_loginfailed`:t.url},(async e=>{if(!e){const e=chrome.runtime.lastError.message;return console.error("response url undefined",e),Vt(`login - response url undefined. ${e}`),/The user did not approve access/gm.test(e)?n():a()}try{const a=await async function(e,t,n,a,o,s="https://deepl.com/oidc/token"){const c=Mr(n,"code");if(!c){const e=Mr(n,"error");if("access_denied"===e)throw new Pr("dl-oidc (get tokens): access denied - undefined code");if("invalid_request"===e)throw new xr("dl-oidc (get tokens): invalid request - undefined code")}const i=await fetch(`${s}`,{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:new URLSearchParams({client_id:e,code_verifier:o,code:c,grant_type:"authorization_code",redirect_uri:t})}),l=await i.json();if(Wr(i.status,l),r(l.id_token).nonce!==a)throw new Fr("dl-oidc (get tokens): invalid nonce");return l}("chromeExtension",chrome.identity.getRedirectURL(),e,t.nonce,t.codeVerifier,"https://w.deepl.com/oidc/token"),o=await lr(a.access_token,a.refresh_token,a.id_token);try{await Br(!0,!1),Da(),Va(),o&&await xa({sessionType:o,trigger:"LOGIN"})}catch(e){console.error(e)}await Tr(),n()}catch(e){console.error(e);try{Bn({errorCode:e.name,errorMessage:e.message})}catch(e){console.error(e)}a(e)}}))}))};try{await t()}catch(e){qr(!0)}}async function Kr(e){const t=await gr(),n=`https://www.deepl.com/auth/logout?${new URLSearchParams([["id_token_hint",t.id_token],["post_logout_redirect_uri",chrome.identity.getRedirectURL()]])}`;chrome.identity.launchWebAuthFlow({url:n,interactive:!0},(async()=>{await fr();try{await Ha()}catch(e){console.error(e)}await dr();try{await Na({trigger:e.trigger,reason:e.reason})}catch(e){console.error(e)}await Br(!0),e.showAlert&&chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlShowAlert",payload:{error:e.reason}})}))}))}async function $r(e,t,n,a){const r=await gr(),o=await pr();let s=r&&r.access_token&&o?"https://api.deepl.com/jsonrpc?client=chrome-extension,1.12.2":"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.12.2";a&&(s=r&&r.access_token&&o?"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2":"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2");try{const{response:a,accessToken:o}=await Hr(s,{method:"POST",headers:{"Content-Type":t},body:e,access_token:r.access_token,refresh_token:r.refresh_token,token_url:"https://w.deepl.com/oidc/token"}),c=await lr(o,r.refresh_token,r.id_token);if(c)try{await xa({sessionType:c,trigger:"TRANSLATION"})}catch(e){console.log(e)}try{await Br(!1,!1)}catch(e){console.error(`Failed to get the client state ${e.message}`)}let i=function(e,t,n){let a;try{a=JSON.parse(e)}catch(e){throw 200===t?new zt("JSON_RPC: Parsing of response object failed"):t>=500&&n?new Qt(`FPT failed: Http status code ${t}`):new en(t.toString(),403===t?`Translation failed: Http status code ${t} forbidden request. re-authenticating makes no difference.`:`Translation failed: Http status code ${t}`)}if("2.0"!==a.jsonrpc||void 0!==a.result&&200!==t||void 0===a.result&&void 0===a.error)throw new zt("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(a.error){const e=a.error;if(void 0===e.code)throw new zt('JSON_RPC: Missing field "code" in error response');throw new en(e.code.toString(),e.message)}if(200!==t)throw new en(t.toString(),`Http status code ${t}`);return a}(await a.text(),a.status,n);return{data:i,status:a.status}}catch(e){throw e.name!==kr&&e.name!==Rr&&e.name!==Dr&&e.name!==Bt&&e.name!==qt||setTimeout((()=>{Kr({trigger:Ve,reason:e.name})}),5e3),e}}async function Xr(e,t,n=(e=>e),a,r,o){const s=function(e,t,n){return{jsonrpc:"2.0",method:e,params:t,id:n}}(e,t,a),c=n(JSON.stringify(s),s);return(await $r(c,"application/json; charset=utf-8",r,o)).data.result}async function Yr(e){let t,n={};for(const t in e.weights)e.weights[t]>0&&(n[t]=e.weights[t]);try{t=await Ar()}catch(e){t=g,console.log(e)}if(t!==u&&e.nicheIntegration===Ne){const n=e.sourceTexts.reduce(((e,t)=>e+t.length),0),a=await Cr();if(t===p&&n>a)throw new tn(a,"Limit exceeded (free account). Please upgrade");if(t===g&&n>a)throw new nn(a,"Limit exceeded (anonymous user). Please upgrade")}let a=e.sourceTexts;const r=["EN-US","EN-GB","PT-PT","PT-BR"].includes(e.targetLangCode?.toUpperCase());let o=e.targetLangCode?.toUpperCase();r&&(o=e.targetLangCode?.toUpperCase().slice(0,2));const s={texts:e.isWriteRequest?e.sourceTexts.map((e=>({text:e,requestAlternatives:4}))):a.map((e=>({text:e}))),...e.isHtml&&{html:"enabled"},...!e.isHtml&&{splitting:e.splitting?e.splitting:"paragraphs"},lang:{target_lang:o,source_lang_user_selected:"auto"===e.sourceLang?"auto":e.sourceLang.toUpperCase(),preference:{weight:n}},commonJobParams:{regionalVariant:e.regionalVariant&&r?e.regionalVariant:void 0,...e.isWriteRequest&&{mode:"write"},...e.formality&&{formality:e.formality}}};let c=1;const i=Date.now();a.forEach((e=>c+=(e.match(/[i]/g)||[]).length)),s.timestamp=i-i%c+c;const l=await Xr("LMT_handle_texts",s,((e,t)=>e=(t.id+3)%13==0||(t.id+5)%29==0?e.replace('"method":"','"method" : "'):e.replace('"method":"','"method": "')),e.id,e.isHtml,e.isWriteRequest);return{texts:l.texts.map((e=>e.text)),sourceLang:l.lang.toUpperCase(),detectedLanguages:l.detectedLanguages}}const Jr=new Map([["ZH_EN","chinese-english"],["EN_ZH","english-chinese"],["NL_EN","dutch-english"],["EN_NL","english-dutch"],["FR_EN","french-english"],["EN_FR","english-french"],["FR_DE","french-german"],["DE_FR","german-french"],["FR_PT","french-portuguese"],["PT_FR","portuguese-french"],["FR_ES","french-spanish"],["ES_FR","spanish-french"],["DE_EN","german-english"],["EN_DE","english-german"],["DE_PT","german-portuguese"],["PT_DE","portuguese-german"],["DE_ES","german-spanish"],["ES_DE","spanish-german"],["IT_EN","italian-english"],["EN_IT","english-italian"],["JA_EN","japanese-english"],["EN_JA","english-japanese"],["PL_EN","polish-english"],["EN_PL","english-polish"],["PT_EN","portuguese-english"],["EN_PT","english-portuguese"],["PT_ES","portuguese-spanish"],["ES_PT","spanish-portuguese"],["RU_EN","russian-english"],["EN_RU","english-russian"],["ES_EN","spanish-english"],["EN_ES","english-spanish"]]);async function Zr(e){const t=function(e,t){const n=`${e.toUpperCase()}_${t.toUpperCase()}`;return Jr.get(n)}(zr(e.sourceLang),zr(e.targetLang)),n=encodeURIComponent(e.text),a=`https://www-app.linguee.com/${t}/search?dlApp=BrowserExtension&il=${e.interfaceLang}&query=${n}`;let r=async function(e){let t;if(200!==e.status)throw 404===e.status?(console.error("Dictionary Entry not found: 404"),new an(Kt)):(console.error("Dictionary Server Error"),new an($t));{try{t=await e.text()}catch(e){throw new an($t)}const n=/href=["']([^"']*)["']/g;t=t.replace(n,"")}return t}(await fetch(a));return r}function zr(e){return["EN-US","EN-GB","PT-PT","PT-BR"].includes(e)?["EN-US","EN-GB"].includes(e)?"EN":["PT-PT","PT-BR"].includes(e)?"PT":e:e}function Qr(e,t){const n=1e-5;return n*Math.floor((.97*e+t)/n)}const eo="PROTOCOL_ERROR",to="FULL_PAGE_SERVER_ERROR",no="-32003",ao="403";class ro extends Error{constructor(e){super(e),this.name=eo,this.message=e}}class oo extends Error{constructor(e,t){super(t),this.name=e,this.message=t}}class so extends Error{constructor(e){super(e),this.name=to,this.message=e}}function co(){let e=new Uint32Array(1);return crypto.getRandomValues(e),e[0]}function io(e,t){return{jsonrpc:"2.0",method:e,params:t,id:co()}}const lo={TRANSLATE:"translate",WRITE:"write"},go="LMT_split_text",uo="LMT_handle_jobs";const po=async({mode:e,texts:t,config:n,sourceLang:a="auto"})=>{const r=`${await To(n,e)}&method=${go}`,o=io(go,{commonJobParams:{mode:e},lang:{lang_user_selected:a},texts:t});return await mo(r,{method:"POST",headers:{"Content-Type":"application/json"},body:yo(o)},n)},ho=async({mode:e,jobs:t,sourceLang:n,targetLang:a,config:r})=>{const o=`${await To(r,e)}&method=${uo}`,s=io(uo,{commonJobParams:{mode:e},lang:{source_lang_computed:n,target_lang:a},jobs:t,priority:1,timestamp:fo(t)});return await mo(o,{method:"POST",headers:{"Content-Type":"application/json"},body:yo(s)},r)},mo=async(e,t,n)=>{const a=await n.auth.getAuthTokens(),r=a?{access_token:a.access_token,refresh_token:a.refresh_token,token_url:n.auth.tokenUrl}:{},{response:o,accessToken:s}=await Hr(e,{...t,...r});return await n.auth.setAuthTokens(s,a.refresh_token,a.id_token),await wo({response:o,isHtml:!1})},To=async({auth:e,baseUrls:t},n)=>{const a=await e.getAuthTokens(),r=(e=>{try{return JSON.parse(atob(e.split(".")[1]))}catch(e){return null}})(a.access_token),o=r&&"Pro"===r.sessionType,s=n===lo.WRITE?t.write:t.translate;return a.access_token&&o?s.pro:s.free},fo=e=>{const t=e.reduce(((e,t)=>[...e,...t.sentences.map((e=>e.text))]),[]);let n=1;const a=Date.now();return t.forEach((e=>n+=(e.match(/[i]/g)||[]).length)),a-a%n+n},yo=e=>{let t=JSON.stringify(e);return t=(e.id+3)%13==0||(e.id+5)%29==0?t.replace('"method":"','"method" : "'):t.replace('"method":"','"method": "'),t},wo=async({response:e,isHtml:t})=>{let n;try{n=JSON.parse(await e.text())}catch(n){throw 200===e.status?new ro("JSON_RPC: Parsing of response object failed"):e.status>=500&&t?new so(`FPT failed: Http status code ${e.status}`):403===e.status?new oo(e.status.toString(),`Translation failed: Http status code ${e.status} forbidden request. re-authenticating makes no difference.`):new oo(e.status.toString(),`Translation failed: Http status code ${e.status}`)}if("2.0"!==n.jsonrpc||void 0!==n.result&&200!==e.status||void 0===n.result&&void 0===n.error)throw new ro("JSON_RPC: missing field, wrong id, proper result without 200 status, or missing data");if(n.error){if(void 0===n.error.code)throw new ro('JSON_RPC: Missing field "code" in error response');throw new oo(n.error.code.toString(),n.error.message)}if(200!==e.status)throw new oo(e.status.toString(),`Http status code ${e.status}`);return n},Eo=lo;async function _o({texts:e,mode:t=lo.TRANSLATE,targetLang:n}){return So((async a=>await async function({texts:e,mode:t=lo.TRANSLATE,targetLang:n,config:a}){const r=await po({mode:t,texts:e,config:a}),o=r.result.texts[0].chunks.map(((e,n,a)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:n<a.length-1&&a.length>1?[a[n+1].sentences[0].text]:[],raw_en_context_before:n>0?[a[n-1].sentences[0].text]:[],sentences:[{...e.sentences[0],id:n}],...t===lo.WRITE&&{write_variant_requests:["main","variants"]}})));return await ho({mode:t,jobs:o,sourceLang:r.result.lang.detected,targetLang:t===lo.WRITE?r.result.lang.detected:n,config:a})}({texts:e,mode:t,targetLang:n,config:a})))}const Lo=async({mode:e,texts:t,sourceLang:n="auto"})=>So((async a=>await po({mode:e,texts:t,sourceLang:n,config:a}))),Io=async({mode:e,jobs:t,sourceLang:n,targetLang:a})=>So((async r=>await ho({mode:e,jobs:t,sourceLang:n,targetLang:a,config:r}))),So=async e=>{try{return await e(Ao())}catch(e){throw e.name!==kr&&e.name!==Rr&&e.name!==Dr&&e.name!==no&&e.name!==ao||setTimeout((()=>{Kr({trigger:Ve,reason:e.name})}),5e3),e}},Ao=()=>({baseUrls:{translate:{free:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.12.2",pro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.12.2"},write:{free:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",pro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2"}},auth:{getAuthTokens:gr,setAuthTokens:lr,tokenUrl:"https://w.deepl.com/oidc/token"}});async function Co(e){const t=await sr(["selectedTargetLanguage"]);chrome.tabs.sendMessage(e,{action:"dlTranslateInline",targetLang:t.selectedTargetLanguage})}async function bo(e){await ir();const n=await sr(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=new Date,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),isHtml:!0,sourceTexts:e.payload.texts,regionalVariant:n.regionalVariant};let o;try{o=await Yr(r)}catch(t){try{qn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.sourceLang,trigger:e.payload.trigger,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0)})}catch(e){console.log(e)}throw t}fs();const s={isFirstTime:e.payload.isFirstTime,processingTimeInMs:new Date-a};try{jn({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:n.selectedTargetLanguage,characterCount:e.payload.texts.reduce(((e,t)=>e+t.length),0),translationPerformance:s,domainName:e.payload.domainName})}catch(e){console.error(e)}return o.texts}async function ko(e){await ir();const n=await sr(["selectedTargetLanguage","session","installationId","languagePreferenceForReading","regionalVariant"]),a=e.payload.nicheIntegration||Ne,r={sourceLang:e.payload.sourceLang||"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:e.payload.requests.map((e=>e.text)),weights:n.languagePreferenceForReading,splitting:"newlines",regionalVariant:n.regionalVariant,nicheIntegration:a,isWriteRequest:e.payload.isWriteRequest};let o;try{o=await Yr(r)}catch(t){try{e.payload.isWriteRequest?Ga(lt,{lang:e.payload.websiteLanguage,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:0,nicheIntegration:a,error:t.name}):qn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,websiteLanguage:e.payload.websiteLanguage,trigger:e.payload.trigger,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}fs(),e.payload.platformBehavior===Fe&&Vs();try{if(o.detectedLanguages){for(const e in o.detectedLanguages)(n.languagePreferenceForReading[e]||0===n.languagePreferenceForReading[e])&&(n.languagePreferenceForReading[e]=Qr(n.languagePreferenceForReading[e],o.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForReading:n.languagePreferenceForReading})}}catch(e){console.error(e)}try{e.payload.isWriteRequest?Ga(at,{lang:e.payload.sourceLang,sourceLength:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),targetLength:o.texts.reduce(((e,t)=>e+t.length),0),nicheIntegration:a}):jn({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:o.sourceLang,targetLanguage:n.selectedTargetLanguage,characterCount:e.payload.requests.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:a})}catch(e){console.error(e)}return o.texts.map((e=>({text:e,detected_source_language:o.sourceLang})))}async function Ro(e){await ir();const n=await sr(["targetLanguageUserInput","session","installationId","languagePreferenceForWriting","regionalVariant"]),a=e.payload.requests,r=e.payload.targetLang||n.targetLanguageUserInput,o=e.payload.platformBehavior||Ne,s={sourceLang:"auto",targetLangCode:r,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],weights:n.languagePreferenceForWriting,splitting:"paragraphs",regionalVariant:n.regionalVariant,nicheIntegration:o,...e.payload.isHtml&&{isHtml:e.payload.isHtml},...e.payload.formality&&{formality:e.payload.formality},...e.payload.isWriteRequest&&{isWriteRequest:e.payload.isWriteRequest}};let c;try{c=await Yr(s)}catch(t){try{e.payload.isWriteRequest?Ga(lt,{lang:e.payload.sourceLang,sourceLength:a.reduce(((e,t)=>e+t.text.length),0),targetLength:0,nicheIntegration:o,error:t.name}):qn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:r,websiteLanguage:e.payload.websiteLanguage,trigger:d,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}if(fs(),e.payload.platformBehavior===Ue?Gs():e.payload.platformBehavior===Fe&&Vs(),c.sourceLang===n.targetLanguageUserInput&&a[0].text.length>15){let e;if("EN"===r)e="DE";else e="EN";let n=await Yr({...s,targetLangCode:e,id:t()});const a=await Yr({...s,sourceTexts:n.texts,id:t()});c.texts=a.texts}try{if(c.detectedLanguages){for(const e in c.detectedLanguages)(n.languagePreferenceForWriting[e]||0===n.languagePreferenceForWriting[e])&&(n.languagePreferenceForWriting[e]=Qr(n.languagePreferenceForWriting[e],c.detectedLanguages[e]));chrome.storage.sync.set({languagePreferenceForWriting:n.languagePreferenceForWriting})}}catch(e){console.error(e)}if(!0!==e.payload.skipDapReporting)try{e.payload.isWriteRequest?Ga(at,{lang:e.payload.sourceLang,sourceLength:a.reduce(((e,t)=>e+t.text.length),0),targetLength:c.texts.reduce(((e,t)=>e+t.length),0),nicheIntegration:o}):jn({installationId:n.installationId,trigger:d,websiteLanguage:c.sourceLang,targetLanguage:r,characterCount:a.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:o})}catch(e){console.error(e)}return[{detected_source_language:c.sourceLang,text:c.texts[0],texts:c.texts}]}async function Do(e){await ir();const n=await sr(["targetLanguage","session","installationId","regionalVariant"]),a=e.payload.requests,r=e.payload.sourceLang,o=e.payload.targetLang||n.targetLanguage,s=Ue,c={sourceLang:r||"auto",targetLangCode:o,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],splitting:"newlines",regionalVariant:n.regionalVariant};let i;try{i=await Yr(c)}catch(t){try{qn({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:o,trigger:d,characterCount:a.reduce(((e,t)=>e+t.text.length),0)})}catch(e){console.log(e)}throw t}fs(),Gs();try{jn({installationId:n.installationId,trigger:l,websiteLanguage:i.sourceLang,targetLanguage:o,characterCount:a.reduce(((e,t)=>e+t.text.length),0),domainName:e.payload.domainName,nicheIntegration:s})}catch(e){console.error(e)}return[{detected_source_language:i.sourceLang,text:i.texts[0],texts:i.texts}]}async function No(e){await ir();const n=await sr(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Yr(r)}catch(t){try{la({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.length})}catch(e){console.log(e)}throw t}fs();try{jn({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:ve})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function Oo(e){await ir();const n=await sr(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.message,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:[a],splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Yr(r)}catch(t){try{ia({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.length,numberOfLanguages:1,numberOfMessages:1,translator:Qe})}catch(e){console.log(e)}throw t}fs();try{ca({messageLang:e.payload.messageLang,targetLang:n.selectedTargetLanguage,messageLength:a.length,numberOfLanguages:1,numberOfMessages:1,translator:Qe}),jn({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.length,domainName:e.payload.domainName,nicheIntegration:xe})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,text:o.texts[0]}]}async function Po(e){await ir();const n=await sr(["selectedTargetLanguage","session","installationId","regionalVariant"]),a=e.payload.messages,r={sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:a,splitting:"paragraphs",regionalVariant:n.regionalVariant};let o;try{o=await Yr(r)}catch(t){try{ia({errorCode:t.name,errorMessage:t.message,domainName:e.payload.domainName,targetLang:n.selectedTargetLanguage,messageLang:e.payload.messageLang,messageLength:a.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:a.length,translator:ze})}catch(e){console.log(e)}throw t}fs();try{ca({messageLang:e.payload.messageLang,targetLang:n.selectedTargetLanguage,messageLength:a.reduce(((e,t)=>e+t.length),0),numberOfLanguages:e.payload.detectedLanguages?.length,numberOfMessages:a.length,translator:ze}),jn({installationId:n.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.messageLang,targetLanguage:n.selectedTargetLanguage,characterCount:a.reduce(((e,t)=>e+t.length),0),domainName:e.payload.domainName,nicheIntegration:xe})}catch(e){console.error(e)}return[{detected_source_language:o.sourceLang,texts:o.texts}]}async function xo(e){const{texts:t,mode:n}=e.payload;return await Lo({texts:t,mode:n})}async function vo(e){await ir();const t=await sr(["session","installationId","regionalVariant"]),{mode:n,sentences:a,sourceLang:r,targetLang:o,domain:s}=e.payload,c=a.map(((e,t)=>({kind:"default",preferred_num_beams:4,raw_en_context_after:t<a.length-1?[a[t+1].text]:[],raw_en_context_before:t>0?[a[t-1].text]:[],sentences:[{...e,id:t+1}],...n===Eo.WRITE&&{write_variant_requests:["main"]}}))),i=new Date,l=await Io({mode:n,jobs:c,sourceLang:r,targetLang:o});try{n===Eo.TRANSLATE&&jn({installationId:t.installationId,trigger:e.payload.trigger,websiteLanguage:e.payload.sourceLang,targetLanguage:o,characterCount:a.map((e=>e.text)).reduce(((e,t)=>e+t.length),0),translationPerformance:{isFirstTime:!1,processingTimeInMs:new Date-i},domainName:s,nicheIntegration:Oe})}catch(e){console.error(e)}return l}async function Uo(e){const{mode:t,sourceLang:n,targetLang:a,sentence:r,contextBefore:o,contextAfter:s}=e.payload,c=[{kind:"default",preferred_num_beams:4,raw_en_context_after:s?[s]:[],raw_en_context_before:o?[o]:[],sentences:[{...r,partial_translation:"",id:0}],...t===Eo.WRITE&&{write_variant_requests:["main","variants"]}}];return await Io({mode:t,jobs:c,sourceLang:n,targetLang:a})}async function Fo(e){const{mode:t,sourceLang:n,targetLang:a,sentence:r,contextBefore:o,contextAfter:s,partialTranslation:c}=e.payload,i=[{kind:"alternatives_at_position",raw_en_context_after:s?[s]:[],raw_en_context_before:o?[o]:[],sentences:[{...r,partial_translation:c,id:0}],...t===Eo.WRITE&&{write_variant_requests:["main"]}}];return await Io({mode:t,jobs:i,sourceLang:n,targetLang:a})}async function Mo(e){const{mode:t,sourceLang:n,targetLang:a,sentence:r,contextBefore:o,contextAfter:s,partialTranslation:c}=e.payload,i=[{kind:"default",raw_en_context_after:s?[s]:[],raw_en_context_before:o?[o]:[],sentences:[{...r,partial_translation:c,id:0}],...t===Eo.WRITE&&{write_variant_requests:["main"]}}];return await Io({mode:t,jobs:i,sourceLang:n,targetLang:a})}async function Go(e){await ir();const n=await sr(["session","installationId","regionalVariant"]),{sourceLang:a,targetLang:r,text:o,trigger:s}=e.payload;let c,i="";const l={sourceLang:a,targetLangCode:r,sessionId:n.session.id,id:t(),sourceTexts:[o],splitting:"paragraphs",regionalVariant:n.regionalVariant};let d;try{d=await Yr(l),i=d.texts?.[0]||""}catch(e){c=e.message}fs(),Ts();try{jn({installationId:n.installationId,trigger:s,websiteLanguage:a,targetLanguage:r,characterCount:o.length,nicheIntegration:Pe})}catch(c){console.error(c)}return[i,c]}async function Wo(e){try{aa({language:e.payload.language,domainName:e.payload.domainName})}catch(e){console.error(e)}}async function Vo(e){try{$n({domainName:e})}catch(e){console.error(e)}}async function Ho(e){try{Xn({domainName:e.domainName,extensionOpenedFrom:ln(e.extensionContext)})}catch(e){console.error(e)}}async function jo(e){try{Yn({logoClickedFrom:dn(e.extensionContext)})}catch(e){console.error(e)}}async function Bo(){try{Qn()}catch(e){console.error(e)}}async function qo(){try{ea()}catch(e){console.error(e)}}async function Ko(e){try{ta({uiFunction:e.uiFunction,uiLocation:e.uiLocation,nicheIntegration:e.nicheIntegration||Ne})}catch(e){console.error(e)}}async function $o(e){try{na({settingType:e.settingType,newValue:e.newValue,uiFunction:e.uiFunction,uiLocation:e.uiLocation,domainName:e.domainName})}catch(e){console.error(e)}}async function Xo(e){try{ra({translationType:e.translationType,domainName:e.domainName})}catch(e){console.error(e)}}async function Yo(e){try{oa({newPosition:e.newPosition})}catch(e){console.error(e)}}async function Jo(e){try{sa(e)}catch(e){console.error(e)}}async function Zo(e){try{da(e)}catch(e){console.error(e)}}async function zo(e){try{pa(e)}catch(e){console.error(e)}}async function Qo(e){try{ga(e)}catch(e){console.error(e)}}async function es(e){try{ha(e)}catch(e){console.error(e)}}async function ts(e){try{ua(e)}catch(e){console.error(e)}}async function ns(e){try{ya(e)}catch(e){console.error(e)}}async function as(e){try{ma(e)}catch(e){console.error(e)}}async function rs(e){try{Ta(e)}catch(e){console.error(e)}}async function os(e){try{_a(e)}catch(e){console.error(e)}}async function ss(e=!1){const t=await br(e);return chrome.runtime.sendMessage({action:"dlExperimentsUpdated",payload:{experiments:[...t]}}),t}async function cs(){qr()}async function is(){Kr({trigger:We})}async function ls(){return{isLoggedIn:await ur(),isProUser:await pr()}}async function ds(e){switch(e.type){case S:{const e=await chrome.storage.sync.get(["notificationsViewed"]);if(e.notificationsViewed&&e.notificationsViewed.hintKeyboardShortcut)return;await chrome.storage.sync.set({notificationsViewed:{...e.notificationsViewed,hintKeyboardShortcut:!0}});break}}try{Jn({notificationType:e.type})}catch(e){console.error(e)}const t=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(t[0].id,{action:"dlShowNotification",payload:e})}async function gs(){return await chrome.commands.getAll()}async function us(e){const t=await gs();try{Zn({shortcutType:e.shortcutType,location:e.location,shortcut:t.filter((t=>t.name===e.shortcutType))[0].shortcut,nicheIntegration:e.nicheIntegration||Ne})}catch(e){console.error(e)}}async function ps(e){zn({uiAction:e.uiAction,nicheIntegration:e.nicheIntegration||Ne})}function hs(e){chrome.tabs.query({active:!0,currentWindow:!0},(function(t){chrome.tabs.sendMessage(t[0].id,{action:"dlTranslateSelectionRightClick",payload:e})}))}async function ms(e){try{fa(e)}catch(e){console.error(e)}}async function Ts(){const e=(await chrome.storage.sync.get(["zendeskSuccessfulTranslations"])).zendeskSuccessfulTranslations+1;await chrome.storage.sync.set({zendeskSuccessfulTranslations:e})}async function fs(){const e=await chrome.storage.sync.get(["isReviewPopupShown","successfulTranslations"]),t=e.successfulTranslations+1;let n=e.isReviewPopupShown;if(!n&&t>=5){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowAskForAReviewPopup"}),n=!0}await chrome.storage.sync.set({isReviewPopupShown:n,successfulTranslations:t})}async function ys(e,t){let n=(e=>{let t=o.find((t=>t.langCode.toUpperCase()===e.toUpperCase()));return t||(t=o.find((t=>t.langCode.substring(0,2).toUpperCase()===e.substring(0,2).toUpperCase())),t)})(e.lang);const a={lang:n.langCodeForSpeech,onEvent:function(e){"end"===e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverStopped"}),"error"==e.type&&chrome.tabs.sendMessage(t,{action:"dlVoiceOverErrorOccurred"})}};(function(){const e=navigator?.userAgentData?.platform||navigator?.platform||void 0;return e&&-1!==e?.toUpperCase().indexOf("MAC")})()&&(a.rate=.9,n.voice&&be===chrome.runtime.id&&(a.voiceName=n.voice)),await chrome.tts.speak(e.text,a)}async function ws(){return(await chrome.tts.getVoices()).map((e=>e.lang.substring(0,2).toUpperCase()))}async function Es(){return chrome.tts.stop()}async function _s(e){try{wa(e)}catch(e){console.error(e)}}async function Ls(e){try{Ia(e)}catch(e){console.error(e)}}async function Is(e){try{Ea(e)}catch(e){console.error(e)}}async function Ss(e){try{Sa(e)}catch(e){console.error(e)}}async function As(e){return await Zr(e)}async function Cs(e){try{Aa(e)}catch(e){console.error(e)}}async function bs(e){try{Ca()}catch(e){console.error(e)}}async function ks(e){try{ba()}catch(e){console.error(e)}}async function Rs({eventType:e,zendeskMetaData:t}){try{Ra(e,t)}catch(e){console.error(e)}}async function Ds(e){try{ka(e)}catch(e){console.error(e)}}async function Ns(e){try{Oa(e)}catch(e){console.error(e)}}async function Os(e){try{Pa(e)}catch(e){console.error(e)}}async function Ps(e){try{va(e)}catch(e){console.error(e)}}async function xs(e){try{Ua(e)}catch(e){console.error(e)}}async function vs({eventType:e,deeplWriteMetaData:t}){try{Ga(e,t)}catch(e){console.error(e)}}async function Us(e){await ir();const n=await sr(["selectedTargetLanguage","session"]),a=e.payload.requests,r={sourceLang:e.payload?.sourceLang?e.payload.sourceLang:"auto",targetLangCode:n.selectedTargetLanguage,sessionId:n.session.id,id:t(),sourceTexts:a.map((e=>e.text))||[],isWriteRequest:!0,...e.payload.isHtml&&{isHtml:!0}};let o;return o=await Yr(r),[{detected_source_language:o.sourceLang,text:o.texts[0],texts:o.texts}]}async function Fs({eventType:e,acceptOrRevertMetadata:t}){try{ja(e,t)}catch(e){console.error(e)}}async function Ms(e){try{Ba(e)}catch(e){console.error(e)}}async function Gs(){const e=await chrome.storage.sync.get(["wasGmailFeedbackPopupShown","successfulTranslationsGmail"]),t=e.successfulTranslationsGmail+1;let n=e.wasGmailFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowGmailFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGmailFeedbackPopupShown:n,successfulTranslationsGmail:t})}async function Ws(e){try{qa(e)}catch(e){console.error(e)}}async function Vs(){const e=await chrome.storage.sync.get(["wasGSlidesFeedbackPopupShown","successfulTranslationsGSlides"]),t=e.successfulTranslationsGSlides+1;let n=e.wasGSlidesFeedbackPopupShown;if(!n&&t>=10){const e=await chrome.tabs.query({active:!0,currentWindow:!0});chrome.tabs.sendMessage(e[0].id,{action:"dlShowSlidesFeedbackPopup"}),n=!0}await chrome.storage.sync.set({wasGSlidesFeedbackPopupShown:n,successfulTranslationsGSlides:t})}async function Hs({eventType:e,alternativesMetaData:t}){try{Ya(e,t)}catch(e){console.error(e)}}async function js(e=!1,t=!0){let n;try{n=await Br(e,t)}catch(e){throw e.name===Dr&&Kr({trigger:Ve,reason:e.name,showAlert:!0}),e}return n}async function Bs(){return await Cr()}function qs(e){try{Ka(e)}catch(e){console.error(e)}}function Ks(e){try{$a(e)}catch(e){console.error(e)}}function $s(e,t){try{Xa(e,t)}catch(e){console.error(e)}}async function Xs({text:e}){return await _o({texts:[e],targetLang:"EN",mode:Eo.WRITE})}const Ys={developer_tools:"DEVELOPER_TOOLS",settings_page:"SETTINGS_PAGE",settings_writing:"SETTINGS_WRITING",settings_reading:"SETTINGS_READING",settings_customizations:"SETTINGS_CUSTOMIZATIONS",onboarding:"ONBOARDING"},Js="dev-page.html",Zs="settings.html",zs="settings.html#inline-translation",Qs="settings.html#input-translation",ec="settings.html#customizations",tc="onboarding.html";function nc({payload:e}){const{destination:t}=e;if(void 0===t)return;let n="";switch(t){case Ys.developer_tools:n=ac(Js);break;case Ys.settings_page:n=ac(Zs);break;case Ys.settings_writing:n=ac(Qs);break;case Ys.settings_reading:n=ac(zs);break;case Ys.settings_customizations:n=ac(ec);break;case Ys.onboarding:n=ac(tc)}n&&chrome.tabs.create({url:n,active:!0})}function ac(e){return chrome.runtime.getURL(e)}function rc(e){let t;try{t=new URL(e)}catch(e){return!1}return"http:"===t.protocol||"https:"===t.protocol}const oc={syncExperiments:"sync_experiments",syncClientState:"sync_client_state"};function sc(e,t,n){switch(Wt()&&console.log(t.tab?`message from a content script: ${t.tab.url} with tab id: ${t.tab.id}. action: ${e.action}`:`message from the extension with action: ${e.action}`),e.action){case"dlRequestHtmlTranslation":bo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestInlineTranslation":ko(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlTriggerTranslateInline":Co(t.tab.id);break;case"dlRequestInputTranslation":Ro(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestGmailReceivedEmailTranslation":Do(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestWhatsAppMessageTranslation":Oo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestTwitterTweetTranslation":No(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestZendeskMessageTranslation":Go(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestWhatsAppMessagesTranslation":Po(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestGDocsSplitText":xo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestGDocsProcessContent":vo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestGDocsSentenceAlternatives":Uo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestGDocsWordAlternatives":Fo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlRequestGDocsSentenceFromPartialTranslation":Mo(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlTrackDetectLanguage":Wo(e),n();break;case"dlRequestLogin":cs().then((()=>n(!0))).catch((e=>{n(rn(e))}));break;case"dlRequestLogout":is().then((()=>n(!0))).catch((e=>{n(rn(e))}));break;case"dlGetAppSettings":chrome.storage.sync.get(null,(function(e){n(e)}));break;case"dlUpdateAppSettings":chrome.storage.sync.set(e.payload,(function(){n(e.payload)}));break;case"dlTranslatedInputTextNotSet":Kn({errorCode:Yt,errorMessage:"The translated text could not be set",domainName:e.payload}),n();break;case"dlGetUserState":ls().then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlExternalURLRedirect":Nt(e.payload),n();break;case"dlOpenInternalPage":nc(e),n();break;case"dlTrackInputTranslationInjection":Vo(e.payload),n();break;case"dlTrackExtensionOpenedEvent":Ho(e.payload),n();break;case"dlTrackLogoClickedEvent":jo(e.payload),n();break;case"dlTrackDocTransClick":Bo(),n();break;case"dlTrackRecommendToAFriendClick":qo(),n();break;case"dlSendNotification":ds(e.payload),n();break;case"dlCheckCommandShortcuts":gs().then((e=>n(e)));break;case"dlTrackUseOfShortcut":us(e.payload),n();break;case"dlTrackUiAction":ps(e.payload),n();break;case"dlTrackInlineSettingOpened":Ko(e.payload),n();break;case"dlTrackSettingChanged":$o(e.payload),n();break;case"dlTrackUILocationClicked":xs(e.payload),n();break;case"dlTrackRightClick":Xo(e.payload),n();break;case"dlTrackInlinePositionChange":Yo(e.payload),n();break;case"dlTrackInlineDragStart":Jo(),n();break;case"dlTrackFptHide":Zo(e.payload);break;case"dlTrackInlineCopy":Qo(e.payload),n();break;case"dlTrackInlineListen":ts(e.payload),n();break;case"dlTrackIconHover":zo(e.payload),n();break;case"dlTrackVoiceOverStops":ns(e.payload),n();break;case"dlTrackOnboardingStepChange":es(e.payload),n();break;case"dlTrackOnboardingOpenExternalLink":as(e.payload),n();break;case"dlTrackReadMore":rs(e.payload),n();break;case"dlTrackLandingOnWebsite":ms(e.payload),n();break;case"dlTrackGDocsReplaceText":os(e.payload),n();break;case"dlGetExperiments":ss(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlGetClientState":js(e.payload?.forceFetch).then((e=>n(e))).catch((e=>n(e)));break;case"dlTextToSpeech":ys(e.payload,t.tab.id).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlGetDictionary":As(e.payload).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlGetSupportedVoices":ws(e.payload).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlStopSpeech":Es(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackOpenInputHighlighter":_s(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackOpenInlineHighlighter":Ls(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackCloseInputHighlighter":Is(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackCloseInlineHighlighter":Ss(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackDictionaryStatus":Cs(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackOpenDictionarySection":bs(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackDisabledDictionaryHover":ks(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackZendeskCustomizationEvent":Rs(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackDeeplWriteEvent":vs(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackLingueeErrorData":Ds(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackGdocsMaxCharExceededShown":Ns(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackGDocsMaxCharExceededTryProClicked":Os(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackOnboardingModalShown":Ps(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlRequestImproveWriting":Us(e).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlTrackTranslateAcceptOrRevertEvent":Fs(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackCustomizationEnabledEvent":Ms(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTrackGmailCharLimitReached":Ws(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlGetUsersCharacterLimit":Bs().then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlTrackAlternativesEvent":Hs(e.payload).then((()=>n())).catch((e=>{n(rn(e))}));break;case"dlTestClassicAPI":Xs(e.payload).then((e=>n(e))).catch((e=>{n(rn(e))}));break;case"dlOnSuccessfulZendeskTranslation":Ts();break;case"dlTrackUpgradeNotificationIsDisplayed":qs(e.payload.type);break;case"dlTrackUpgradeNotificationClosed":Ks(e.payload.type);break;case"dlTrackUpgradeNotificationAction":$s(e.payload.type,e.payload.cta)}return!0}function cc(e){switch(console.log(`Command "${e}" triggered`),e){case ne:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlTriggerTranslationShortcut"})}));break;case ae:chrome.tabs.query({active:!0,currentWindow:!0},(function(e){chrome.tabs.sendMessage(e[0].id,{action:"dlChangeLanguageShortcut"})}))}}function ic(e){try{js(!0),chrome.runtime.setUninstallURL("https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU"),e.reason===chrome.runtime.OnInstalledReason.UPDATE&&console.log(`Update from version ${e.previousVersion} to ${chrome.runtime.getManifest().version} was completed`),async function(){let e=!1;const t=await chrome.storage.sync.get(null),a={settingSchemeVersion:2.7,blacklistDomains:[],blacklistDomainsForReading:[],blacklistDomainsForWriting:[],languagesForTranslation:o.reduce(((e,t)=>({...e,[t.langCode]:s})),{}),selectedTargetLanguage:xt(),isTargetLanguageConfirmed:!1,deepLProApiKey:{IS_PROD:!0,BASE_URLS:{dapApi:"https://s.deepl.com/chrome/statistics",toolingApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.12.2",toolingApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.12.2",toolingWriteApiPro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",toolingWriteApi:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApi:"https://www2.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApiPro:"https://api.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApiWrite:"https://write-free.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",classicApiWritePro:"https://write-pro.www.deepl.com/jsonrpc?client=chrome-extension,1.12.2",login:"https://www.deepl.com/auth/login",token:"https://w.deepl.com/oidc/token",logout:"https://www.deepl.com/auth/logout",feedbackSurvey:"https://deepl.typeform.com/to/MkMfP2Y6",newFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_cMvbeX0WZGvkKGi",uninstallSurvey:"https://deepl.qualtrics.com/jfe/form/SV_eJxAD8c7J5hqSRU",gslidesFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_9XBLSAbDmLq5emO",deeplPro:"https://www.deepl.com/pro",deeplTranslator:"https://www.deepl.com/translator",deeplDoctrans:"https://www.deepl.com/translator/files",extensionStorePage:"https://bit.ly/DeepL-Chrome",supportArticle:"https://support.deepl.com/hc/articles/4407580229522",deeplSupport:"https://support.deepl.com/hc",chromeWebstore:"https://chrome.google.com/webstore/detail/deepl-translate-reading-w/cofdbpoegempjloogbagkncekinflcnj",edgeWebstore:"https://microsoftedge.microsoft.com/addons/detail/deepl-translate-reading-/fancfknaplihpclbhbpclnmmjcjanbaf",clientStateApi:"https://w.deepl.com/web",experimentsEndpoint:"https://s.deepl.com/chrome/experiments",gmailFeedbackSurvey:"https://deepl.qualtrics.com/jfe/form/SV_db8ItFTmYBcZjYW"},APP_VERSION:"1.12.2",FEATURE_FLAGS:{TRANSLATE_INPUT:!0,PAGE_TRANSLATION:!0,IMPROVE_WRITING:!0,DOCUMENT_TRANSLATION:!0,RECOMMEND_TO_A_FRIEND:!0,PRO_LOGIN:!0,WEBPAGE_CUSTOMIZER:!0,GDOCS_INTEGRATION:!0,ZENDESK_INTEGRATION:!0,GMAIL_INTEGRATION:!0,GSLIDES_INTEGRATION:!1,ON_INSTALL_ONBOARDING:!0,WHATSAPP_TRANSLATE_ALL_CHAT:!1,DEEPL_WRITE_GENERAL:!1,DEEPL_WRITE_GDOCS:!0}}.DEEPL_PRO_API_KEY,installationId:n(),enableFullPageTranslation:!0,enableInputTranslation:!0,enableInlineTranslation:!0,languagePreferenceForWriting:vt(),languagePreferenceForReading:vt(),blacklistedPopupWidgets:[],successfulTranslations:0,isReviewPopupShown:!1,shouldDisplayFeedbackPopup:!1,isInputHighlighterShown:!1,isInlineHighlighterShown:!1,regionalVariant:void 0,isSurveyLinkHidden:!1,isZendeskOnboarded:!1,isZendeskEnabled:!0,isZendeskOnboardingShown:!1,zendeskFormality:"auto",zendeskSuccessfulTranslations:0,isGDocsOnboardingShown:!1,gDocsSegmentation:St,isGmailEnabled:!0,wasGmailOnboardingShown:!1,successfulTranslationsGmail:0,wasGmailFeedbackPopupShown:!1,isGSlidesEnabled:!0,isGSlidesOnboardingShown:!1,wasGSlidesFeedbackPopupShown:!1,successfulTranslationsGSlides:0};if(!t||!t.settingSchemeVersion||t.settingSchemeVersion<a.settingSchemeVersion){let n={};for(const[r,o]of Object.entries(a))r in t&&"settingSchemeVersion"!==r?n[r]=t[r]:("installationId"===r&&(e=!0),n[r]=o);await chrome.storage.sync.clear(),await chrome.storage.sync.set(n),console.log("settings set: ",n)}return{installationIdWasSet:e}}().then((t=>{!async function(e,t){const n=await Lr();n||e!==chrome.runtime.OnInstalledReason.INSTALL?n||await _r():(await _r(),La(),Ma());t&&Fa()}(e.reason,t.installationIdWasSet)})),e.reason===chrome.runtime.OnInstalledReason.INSTALL&&Gt()!==Mt&&nc({payload:{destination:Ys.onboarding}}),chrome.contextMenus.removeAll((function(){chrome.contextMenus.create({type:"normal",id:"dlChangeLanguageShortcut",title:chrome.i18n.getMessage("extension_settings_keyboard_shortcut_change_language"),checked:!1,contexts:["all"]},(function(){})),chrome.contextMenus.create({type:"normal",id:"dlTranslateInline",title:chrome.i18n.getMessage("context_menus_translate_section"),checked:!1,contexts:["all"]})})),chrome.tabs.query({},(function(e){for(const t of e)rc(t)&&chrome.scripting.executeScript({target:{tabId:t},files:["build/content.js"]})}));try{ss(!0),async function(){await chrome.alarms.clearAll(),await chrome.alarms.create(oc.syncExperiments,{delayInMinutes:10,periodInMinutes:10}),await chrome.alarms.create(oc.syncClientState,{delayInMinutes:30,periodInMinutes:30})}()}catch(e){console.error(e)}}catch(e){Bn({errorCode:Xt,errorMessage:e.message})}}function lc(e){switch(e.name){case oc.syncExperiments:ss();break;case oc.syncClientState:js()}}function dc(e){switch(e.menuItemId){case"dlTranslateInline":hs(!1);break;case"dlChangeLanguageShortcut":hs(!0)}}function gc(){}const uc={setBrowserExtensionUserAgent:{type:"modifyHeaders",requestHeaders:[{header:"user-agent",operation:"set",value:`DeepLBrowserExtension/1.12.2 ${navigator.userAgent} `}]}},pc={lingueeDomainFilter:{excludedDomains:["linguee.com"],urlFilter:"*://www-app.linguee.com*",resourceTypes:["xmlhttprequest"]},deeplToolingApiDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://*.deepl.com/jsonrpc?client=chrome-extension,*",resourceTypes:["xmlhttprequest"]},deeplStatisticsDomainFilter:{excludedDomains:["deepl.com"],urlFilter:"*://s.deepl.*/chrome/statistics*",resourceTypes:["xmlhttprequest"]}};function hc(){chrome.declarativeNetRequest.updateDynamicRules({removeRuleIds:[2,3,4],addRules:[{id:2,priority:1,action:uc.setBrowserExtensionUserAgent,condition:pc.lingueeDomainFilter},{id:3,priority:1,action:uc.setBrowserExtensionUserAgent,condition:pc.deeplToolingApiDomainFilter},{id:4,priority:1,action:uc.setBrowserExtensionUserAgent,condition:pc.deeplStatisticsDomainFilter}]},(async e=>{await console.log("created",e)}))}return hc(),chrome.runtime.onInstalled.addListener(ic),chrome.contextMenus.onClicked.addListener(dc),chrome.tabs.onActivated.addListener((async function(e){rc((await chrome.tabs.get(e.tabId)).url)&&chrome.tabs.sendMessage(e.tabId,{action:"dlTabChanged"}),chrome.tabs.query({},(function(t){for(var n=0;n<t.length;++n)chrome.tabs.sendMessage(t[n].id,{action:"dlChangeActiveTabStatus",payload:{isActive:t[n].id===e.tabId}})})),js()})),chrome.runtime.onConnect.addListener((e=>{Wt()&&console.log(`port connected to tab with id: ${e.sender.tab.id}`)})),chrome.runtime.onMessage.addListener(sc),chrome.storage.onChanged.addListener(gc),chrome.commands.onCommand.addListener(cc),chrome.alarms.onAlarm.addListener(lc),self.addEventListener("error",(function(e){Vt(e.message)})),e.CONTENT_PROCESS_MODE=Eo,e.INTERNAL_PAGE_KEYS=Ys,e.PERODIC_CODE_EXECUTION_NAMES=oc,e.URL_ACTIONS=kt,e.URL_LIST=Rt,e.cacheClientState=tr,e.cacheExperiments=ar,e.checkCommandShortcuts=gs,e.clearLoginTimestamp=fr,e.commandListener=cc,e.connectDatabase=za,e.deleteAuthTokens=dr,e.fetchClientState=Br,e.fetchExperiments=br,e.fetchGDocsSentenceAlternatives=Uo,e.fetchGDocsWordAlternatives=Fo,e.getAccountID=Ir,e.getAuthTokens=gr,e.getBrowserInstanceId=Lr,e.getCachedClientState=nr,e.getCachedExperiments=or,e.getCharacterLimit=Cr,e.getClientState=js,e.getCurrentExperiments=rr,e.getDapAlternativesSegmentationType=On,e.getDapApiConfig=on,e.getDapApiExtensionOpenedFromId=ln,e.getDapApiInlinePositionType=fn,e.getDapApiLingueeError=cn,e.getDapApiLogoClickedFromId=dn,e.getDapApiNotificationType=gn,e.getDapApiSettingType=Tn,e.getDapApiShortcutTypes=pn,e.getDapApiTranslationTriggerId=sn,e.getDapApiUiActionEventId=hn,e.getDapApiUiFunctionality=mn,e.getDapApiUiLocation=un,e.getDapContentProcessingModeType=Dn,e.getDapGmailActionType=kn,e.getDapLogoutTrigger=Sn,e.getDapNicheIntegration=Ln,e.getDapOnboardingExternalLink=yn,e.getDapOnboardingStepChangeTrigger=wn,e.getDapOriginStore=En,e.getDapServiceLevel=bn,e.getDapSessionType=Pn,e.getDapSessionTypeTrigger=An,e.getDapUpgradeNotificationAction=Nn,e.getDapUpgradeNotificationType=Rn,e.getDapWhatsAppTranslator=Cn,e.getDictionary=As,e.getExperiments=ss,e.getExperimentsData=Sr,e.getExternalUrl=Dt,e.getInstallationId=mr,e.getSecondsSinceLastLogin=yr,e.getSessionType=hr,e.getSettings=sr,e.getSupportedVoices=ws,e.getUserInfo=Er,e.getUserState=ls,e.getUserType=Ar,e.getUsersCharacterLimit=Bs,e.getWebsiteIdFromWebsite=_n,e.handleJobs=Io,e.handleSuccessfulGmailTranslationsCount=Gs,e.handleSuccessfulGslidesTranslationsCount=Vs,e.handleSuccessfulZendeskTranslationsCount=Ts,e.improveWriting=Us,e.isPayloadNecessaryForUIEvent=In,e.isProUser=pr,e.isUserLoggedIn=ur,e.jsonrpc_callFunction=Xr,e.jsonrpc_composeMethodCallDict=jr,e.listenToPerodicCodeExecution=lc,e.login=qr,e.loginRequest=cs,e.logout=Kr,e.logoutRequest=is,e.markLoginTimestamp=Tr,e.messageListener=sc,e.onContextMenuClicked=dc,e.onInstalled=ic,e.onStorageChanged=gc,e.openInternalPage=nc,e.performGDocsProcessContent=vo,e.performGDocsSplitText=xo,e.processContent=_o,e.readData=er,e.rebuildGDocsSentenceFromPartialTranslation=Mo,e.redirectToExternalURL=Nt,e.requestDictionary=Zr,e.sendDAPAlternativesEvent=Ya,e.sendDAPBrowserInstanceIdCreated=Ma,e.sendDAPCloseInlineHighlighter=Sa,e.sendDAPCloseInputHighlighter=Ea,e.sendDAPContentScriptErrorData=Kn,e.sendDAPCustomizationEnabled=Ba,e.sendDAPDeeplWriteEvent=Ga,e.sendDAPDetectLanguage=aa,e.sendDAPDictionaryStatus=Aa,e.sendDAPDisabledDictionaryHover=ba,e.sendDAPDocTransClick=Qn,e.sendDAPErrorData=Bn,e.sendDAPExtensionOpened=Xn,e.sendDAPFPTHide=da,e.sendDAPFTPBlockSizeExceeded=async function(e){return Hn((t=>({...t,eventId:60006,fptBlockSizeExceededData:{translationData:{sourceLang:e.websiteLanguage,targetLang:e.targetLanguage,sourceLength:e.characterCount},domainName:e.domainName}})))},e.sendDAPGDocsMaxCharExceededShown=Oa,e.sendDAPGDocsMaxCharExceededTryProClicked=Pa,e.sendDAPGDocsReplaceText=_a,e.sendDAPGmailCharLimitReached=qa,e.sendDAPIconHover=pa,e.sendDAPInlineCopy=ga,e.sendDAPInlineDragStart=sa,e.sendDAPInlineListen=ua,e.sendDAPInlinePositionChange=oa,e.sendDAPInlineSettingOpened=ta,e.sendDAPInputTranslationInjection=$n,e.sendDAPInstallSuccess=La,e.sendDAPInstallationIdCreated=Fa,e.sendDAPLandingOnSpecificWebsite=fa,e.sendDAPLingueeErrorData=ka,e.sendDAPLoggedIn=Va,e.sendDAPLoggedOut=Ha,e.sendDAPLogin=Da,e.sendDAPLogoClicked=Yn,e.sendDAPLogout=Na,e.sendDAPNotificationViewed=Jn,e.sendDAPOnboardingModalShown=va,e.sendDAPOnboardingOpenExternalPage=ma,e.sendDAPOnboardingStepChange=ha,e.sendDAPOpenDictionarySection=Ca,e.sendDAPOpenInlineHighlighter=Ia,e.sendDAPOpenInputHighlighter=wa,e.sendDAPReadMoreClicked=Ta,e.sendDAPRecommendToAFriendClick=ea,e.sendDAPRightClick=ra,e.sendDAPSessionStarted=Wa,e.sendDAPSettingsChanged=na,e.sendDAPShortcutUsed=Zn,e.sendDAPTrackUpgradeNotificationAction=Xa,e.sendDAPTrackUpgradeNotificationClosed=$a,e.sendDAPTrackUpgradeNotificationDisplayed=Ka,e.sendDAPTranslateAcceptOrUndoEvent=ja,e.sendDAPTranslationErrorData=qn,e.sendDAPTranslationRequest=jn,e.sendDAPTwitterTweetTranslationFailed=la,e.sendDAPUILocationClicked=Ua,e.sendDAPUiAction=zn,e.sendDAPVoiceOverStops=ya,e.sendDAPWhatsAppMessageTranslated=ca,e.sendDAPWhatsAppMessageTranslationFailed=ia,e.sendDAPZendeskCustomizationEvent=Ra,e.sendDAPtrackSessionType=xa,e.sendNotification=ds,e.setAuthTokens=lr,e.setBrowserInstanceId=_r,e.setUserInfoFromClientState=wr,e.splitText=Lo,e.stopSpeech=Es,e.testClassicApi=Xs,e.textToSpeech=ys,e.trackAlternativesEvent=Hs,e.trackCloseInlineHighlighter=Ss,e.trackCloseInputHighlighter=Is,e.trackCustomizationEnabled=Ms,e.trackDeeplWriteEvent=vs,e.trackDetectLanguage=Wo,e.trackDictionaryStatus=Cs,e.trackDisabledDictionaryHover=ks,e.trackDocTransClick=Bo,e.trackExtensionOpenedEvent=Ho,e.trackFptHide=Zo,e.trackGDocsMaxCharExceededTryProClicked=Os,e.trackGDocsReplaceText=os,e.trackGdocsMaxCharExceededShown=Ns,e.trackGmailCharLimitReached=Ws,e.trackIconHover=zo,e.trackInlineCopy=Qo,e.trackInlineDragStart=Jo,e.trackInlineListen=ts,e.trackInlinePositionChange=Yo,e.trackInlineSettingsOpened=Ko,e.trackInputTranslationInjection=Vo,e.trackLandingOnWebsite=ms,e.trackLingueeErrorData=Ds,e.trackLogoClickedEvent=jo,e.trackOnboardingModalShown=Ps,e.trackOnboardingOpenExternalLink=as,e.trackOnboardingStepChange=es,e.trackOpenDictionarySection=bs,e.trackOpenInlineHighlighter=Ls,e.trackOpenInputHighlighter=_s,e.trackReadMoreClick=rs,e.trackRecommendToAFriendClick=qo,e.trackRightClick=Xo,e.trackSettingChanged=$o,e.trackTranslateAcceptOrUndoEvent=Fs,e.trackUILocationClicked=xs,e.trackUiAction=ps,e.trackUpgradeNotificationAction=$s,e.trackUpgradeNotificationClosed=Ks,e.trackUpgradeNotificationDisplayed=qs,e.trackUseOfShortcut=us,e.trackVoiceOverStops=ns,e.trackZendeskCustomizationEvent=Rs,e.translate=Yr,e.translateGmailReceivedEmail=Do,e.translateHtmlRequest=bo,e.translateInlineRequest=ko,e.translateInputRequest=Ro,e.translateSelection=hs,e.translateTwitterTweetRequest=No,e.translateWhatsAppMessageRequest=Oo,e.translateWhatsAppMessagesRequest=Po,e.translateZendeskMessageRequest=Go,e.triggerTranslateInline=Co,e.updateDynamicRules=hc,e.updateSession=ir,e.writeData=Qa,Object.defineProperty(e,"__esModule",{value:!0}),e}({});
//# sourceMappingURL=background.js.map
